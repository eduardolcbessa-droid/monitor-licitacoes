<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0A0E17">
<link rel="manifest" href="./manifest.json">
<title>LicitaMonitor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0A0E17;--bg2:#111827;--bg3:#1A2035;--bg4:#222B42;--brd:#1E293B;--brda:#334155;--txt:#F1F5F9;--txs:#CBD5E1;--txm:#64748B;--txd:#475569;--blue:#3B82F6;--blueg:rgba(59,130,246,.12);--blued:#2563EB;--green:#10B981;--greeng:rgba(16,185,129,.1);--amber:#F59E0B;--amberg:rgba(245,158,11,.1);--red:#EF4444;--redg:rgba(239,68,68,.08);--purple:#8B5CF6;--purpleg:rgba(139,92,246,.1);--cyan:#06B6D4;--cyang:rgba(6,182,212,.1);--r:16px;--rs:10px;--rr:8px;--f:'Instrument Sans',system-ui,sans-serif;--mono:'Space Mono',monospace;--shadow:0 1px 3px rgba(0,0,0,.3),0 4px 16px rgba(0,0,0,.2)}
html{scroll-behavior:smooth}body{font-family:var(--f);background:var(--bg);color:var(--txt);min-height:100dvh;line-height:1.55;-webkit-font-smoothing:antialiased}
nav{position:sticky;top:0;z-index:50;background:rgba(10,14,23,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--brd);padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.nav-brand{display:flex;align-items:center;gap:10px}.nav-logo{width:34px;height:34px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:9px;display:grid;place-items:center;font:700 15px/1 var(--mono);color:#fff;letter-spacing:-1px}.nav-name{font-size:16px;font-weight:700;letter-spacing:-.3px}.nav-badge{font:500 10px/1 var(--mono);color:var(--txm);background:var(--bg3);padding:3px 8px;border-radius:20px;border:1px solid var(--brd)}
.nav-status{display:flex;align-items:center;gap:6px;font:400 11px/1 var(--mono);color:var(--txm)}.nav-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:blink 2.5s infinite}@keyframes blink{50%{opacity:.4}}
main{max-width:960px;margin:0 auto;padding:16px}
.install{background:linear-gradient(135deg,var(--blueg),var(--purpleg));border:1px solid rgba(59,130,246,.15);border-radius:var(--r);padding:14px 18px;margin-bottom:14px;display:none;align-items:center;justify-content:space-between;gap:10px}.install.show{display:flex}.install-txt{font-size:13px;font-weight:500}.install-txt small{display:block;color:var(--txm);font-size:11px;font-weight:400;margin-top:1px}.install-btn{padding:7px 16px;background:var(--blue);color:#fff;border:none;border-radius:var(--rs);font:600 12px var(--f);cursor:pointer}.install-x{background:none;border:none;color:var(--txm);font-size:16px;cursor:pointer;padding:2px}
.card{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);margin-bottom:14px;overflow:hidden}.card-head{padding:14px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--brd);cursor:pointer;user-select:none;transition:background .15s}.card-head:hover{background:var(--bg3)}.card-title{font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px;letter-spacing:-.2px}.card-title svg{width:16px;height:16px;color:var(--blue);flex-shrink:0}.card-toggle{font:500 11px var(--mono);color:var(--txm);transition:transform .2s}.card-body{padding:16px 18px}.card-body.collapsed{display:none}
.portals{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}.portal{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--bg3);border:1px solid transparent;border-radius:var(--rs);text-decoration:none;color:var(--txt);transition:all .15s;font-size:12px;font-weight:500}.portal:hover{border-color:var(--brda);background:var(--bg4)}.portal-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.portal-dot.c1{background:var(--blue)}.portal-dot.c2{background:var(--amber)}.portal-dot.c3{background:var(--red)}.portal-dot.c4{background:var(--green)}.portal-dot.c5{background:var(--cyan)}.portal-dot.c6{background:var(--purple)}.portal-arrow{margin-left:auto;color:var(--txm);font-size:14px}
.fg{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px}@media(max-width:600px){.fg{grid-template-columns:1fr}}.fg label{display:block;font:500 10px/1 var(--mono);color:var(--txm);text-transform:uppercase;letter-spacing:.8px;margin-bottom:5px}.fg input,.fg select{width:100%;padding:8px 10px;background:var(--bg);border:1px solid var(--brd);border-radius:var(--rr);color:var(--txt);font:400 13px var(--f);outline:none;transition:border .15s}.fg input:focus,.fg select:focus{border-color:var(--blue)}.fg input[type=date]{font:400 12px var(--mono)}
.uf-bar{margin-bottom:14px}.uf-presets{display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap}.uf-pre{font:500 10px var(--f);padding:4px 10px;background:none;border:1px solid var(--brd);border-radius:20px;color:var(--txm);cursor:pointer;transition:all .15s}.uf-pre:hover{border-color:var(--blue);color:var(--blue)}.uf-pre.on{background:var(--blue);color:#fff;border-color:var(--blue)}.uf-grid{display:flex;flex-wrap:wrap;gap:4px}.uf-chip{font:600 10px var(--mono);padding:4px 7px;background:none;border:1px solid var(--brd);border-radius:5px;color:var(--txd);cursor:pointer;transition:all .1s}.uf-chip:hover{color:var(--txs);border-color:var(--txm)}.uf-chip.on{background:var(--blueg);border-color:rgba(59,130,246,.35);color:var(--blue)}.uf-chip.on.df-hl{background:var(--amberg);border-color:rgba(245,158,11,.35);color:var(--amber)}
.sl{font:500 10px/1 var(--mono);color:var(--txm);text-transform:uppercase;letter-spacing:.8px;display:block;margin-bottom:6px}
.kw-bar{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px}.kw{font:400 11px var(--mono);padding:4px 10px;background:none;border:1px solid var(--brd);border-radius:20px;color:var(--txd);cursor:pointer;transition:all .15s}.kw:hover{color:var(--txs);border-color:var(--txm)}.kw.on{background:var(--blueg);border-color:rgba(59,130,246,.2);color:var(--blue)}
.actions{display:flex;gap:8px}.btn{padding:9px 20px;border-radius:var(--rr);font:600 13px var(--f);cursor:pointer;transition:all .15s;border:none;display:inline-flex;align-items:center;gap:6px}.btn svg{width:14px;height:14px}.btn-p{background:var(--blue);color:#fff}.btn-p:hover{background:var(--blued)}.btn-p:disabled{opacity:.4;cursor:default}.btn-s{background:none;color:var(--txm);border:1px solid var(--brd)}.btn-s:hover{color:var(--txs);border-color:var(--txm)}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:14px}@media(max-width:600px){.stats{grid-template-columns:repeat(2,1fr)}}.stat{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--rs);padding:12px 14px}.stat-label{font:500 9px/1 var(--mono);color:var(--txm);text-transform:uppercase;letter-spacing:.6px}.stat-val{font:700 24px/1.2 var(--mono);margin-top:4px}.sv-blue{color:var(--blue)}.sv-green{color:var(--green)}.sv-amber{color:var(--amber)}.sv-cyan{color:var(--cyan)}
.ruf-bar{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:12px;align-items:center}.ruf-label{font:500 10px var(--mono);color:var(--txm);margin-right:4px;text-transform:uppercase;letter-spacing:.5px}.ruf-chip{font:400 10px var(--mono);padding:3px 8px;background:var(--bg2);border:1px solid var(--brd);border-radius:20px;color:var(--txm);cursor:pointer;transition:all .12s}.ruf-chip:hover{border-color:var(--blue)}.ruf-chip.on{background:var(--blueg);border-color:rgba(59,130,246,.25);color:var(--blue)}.ruf-count{font-size:9px;opacity:.6;margin-left:1px}
.res-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.res-count{font-size:13px;color:var(--txm)}.res-count b{color:var(--txt)}.sort-sel{padding:5px 8px;background:var(--bg);border:1px solid var(--brd);border-radius:var(--rr);color:var(--txm);font:400 11px var(--f);outline:none;cursor:pointer}
.res-list{display:flex;flex-direction:column;gap:8px}
.res-card{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:16px 18px;transition:all .15s;cursor:pointer;position:relative}.res-card:hover{background:var(--bg3);border-color:var(--brda)}.res-card.is-new{border-left:3px solid var(--green)}.new-tag{position:absolute;top:10px;right:12px;font:700 8px/1 var(--mono);padding:3px 7px;background:var(--greeng);color:var(--green);border-radius:10px;text-transform:uppercase;letter-spacing:.8px}
.res-top{display:flex;align-items:center;gap:6px;margin-bottom:8px;flex-wrap:wrap}.uf-badge{font:700 9px/1 var(--mono);padding:3px 6px;border-radius:4px;letter-spacing:.3px}.ub-df{background:var(--amberg);color:var(--amber);border:1px solid rgba(245,158,11,.2)}.ub-go{background:var(--greeng);color:var(--green);border:1px solid rgba(16,185,129,.2)}.ub-x{background:var(--purpleg);color:var(--purple);border:1px solid rgba(139,92,246,.2)}.res-org{font:600 10px/1 var(--f);color:var(--blue);text-transform:uppercase;letter-spacing:.2px}.res-mod{font:400 9px/1 var(--mono);padding:3px 8px;border-radius:20px;margin-left:auto;white-space:nowrap}.mod-c{background:var(--blueg);color:var(--blue)}.mod-p{background:var(--greeng);color:var(--green)}.mod-d{background:var(--amberg);color:var(--amber)}.mod-o{background:var(--purpleg);color:var(--purple)}
.res-obj{font-size:14px;font-weight:500;line-height:1.5;margin-bottom:10px}.res-obj mark{background:rgba(59,130,246,.15);color:var(--blue);padding:0 3px;border-radius:3px}
.res-meta{display:flex;flex-wrap:wrap;gap:12px;font-size:11px;color:var(--txm)}.res-meta svg{width:12px;height:12px;color:var(--txd);flex-shrink:0}.mi{display:flex;align-items:center;gap:4px}.mi b{color:var(--txt);font-weight:500}.mi .val{color:var(--green);font-family:var(--mono);font-weight:700}
.res-link{display:inline-flex;align-items:center;gap:4px;font:500 11px var(--f);color:var(--blue);text-decoration:none;margin-top:8px}
.loading{text-align:center;padding:48px 16px;display:none}.loading.on{display:block}.loader{width:32px;height:32px;border:3px solid var(--brd);border-top-color:var(--blue);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}@keyframes spin{to{transform:rotate(360deg)}}.load-txt{font-size:13px;color:var(--txm)}.load-det{font:400 11px var(--mono);color:var(--txd);margin-top:3px}
.empty{text-align:center;padding:48px 16px;color:var(--txm)}.empty-icon{font-size:36px;margin-bottom:10px;opacity:.5}.empty-t{font-size:15px;font-weight:600;color:var(--txt);margin-bottom:4px}
.error{background:var(--redg);border:1px solid rgba(239,68,68,.15);border-radius:var(--r);padding:14px 18px;display:none;align-items:flex-start;gap:8px;margin-bottom:12px;font-size:13px;color:var(--red)}.error.on{display:flex}.error b{display:block;margin-bottom:2px}.error small{color:var(--txm);font-size:11px}
footer{text-align:center;padding:24px 16px;border-top:1px solid var(--brd);margin-top:32px;font:400 11px var(--f);color:var(--txd)}footer a{color:var(--txm);text-decoration:none}
.fi{animation:fadeUp .25s ease-out both}@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<nav><div class="nav-brand"><div class="nav-logo">LM</div><span class="nav-name">LicitaMonitor</span><span class="nav-badge">v2.0</span></div><div class="nav-status"><span class="nav-dot"></span><span id="stTxt">Iniciando</span></div></nav>
<main>
<div class="install" id="installB"><div class="install-txt">Instalar na tela inicial<small>Acesso r√°pido como app nativo</small></div><div style="display:flex;gap:6px;align-items:center"><button class="install-btn" id="installBtn">Instalar</button><button class="install-x" onclick="document.getElementById('installB').classList.remove('show')">√ó</button></div></div>
<div class="card"><div class="card-head" onclick="tog('portais')"><span class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>Portais</span><span class="card-toggle" id="tog-portais">‚ñº</span></div><div class="card-body" id="body-portais"><div class="portals"><a class="portal" href="https://pncp.gov.br/app/editais?q=pavimenta%C3%A7%C3%A3o&uf=DF" target="_blank"><span class="portal-dot c1"></span>PNCP<span class="portal-arrow">‚Üí</span></a><a class="portal" href="https://dodf.df.gov.br/" target="_blank"><span class="portal-dot c5"></span>DODF<span class="portal-arrow">‚Üí</span></a><a class="portal" href="https://portal.compras.df.gov.br/licitacao" target="_blank"><span class="portal-dot c2"></span>Compras DF<span class="portal-arrow">‚Üí</span></a><a class="portal" href="http://app.novacap.df.gov.br/sislicitapublica/" target="_blank"><span class="portal-dot c3"></span>NOVACAP<span class="portal-arrow">‚Üí</span></a><a class="portal" href="https://www.gov.br/compras/pt-br/acesso-a-informacao/consulta-detalhada" target="_blank"><span class="portal-dot c4"></span>Compras.gov<span class="portal-arrow">‚Üí</span></a><a class="portal" href="https://www.sinj.df.gov.br/sinj/" target="_blank"><span class="portal-dot c6"></span>SINJ-DF<span class="portal-arrow">‚Üí</span></a></div></div></div>
<div class="card"><div class="card-head" onclick="tog('filtros')"><span class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h18l-7 8.5V18l-4 2V12.5L3 4z"/></svg>Filtros PNCP</span><span class="card-toggle" id="tog-filtros">‚ñº</span></div><div class="card-body" id="body-filtros"><div class="fg"><div><label>Data inicial</label><input type="date" id="dI"/></div><div><label>Data final</label><input type="date" id="dF"/></div><div><label>Modalidade</label><select id="mod"><option value="">Todas</option><option value="4">Concorr√™ncia Eletr√¥nica</option><option value="5">Concorr√™ncia Presencial</option><option value="6">Preg√£o Eletr√¥nico</option><option value="8">Dispensa de Licita√ß√£o</option><option value="9">Inexigibilidade</option><option value="12">Credenciamento</option></select></div></div><div class="uf-bar"><span class="sl">Estados</span><div class="uf-presets"><button class="uf-pre" onclick="ufP('df')">DF</button><button class="uf-pre" onclick="ufP('dg')">DF+GO</button><button class="uf-pre" onclick="ufP('dv')">DF+Vizinhos</button><button class="uf-pre" onclick="ufP('all')">Todos</button><button class="uf-pre" onclick="ufP('x')">Limpar</button></div><div class="uf-grid" id="ufG"></div></div><span class="sl">Palavras-chave</span><div class="kw-bar"><span class="kw on" data-k="paviment">pavimenta√ß√£o</span><span class="kw on" data-k="cbuq">CBUQ</span><span class="kw on" data-k="fresag">fresagem</span><span class="kw on" data-k="terraplenag">terraplenagem</span><span class="kw on" data-k="asfalt">asfalto</span><span class="kw on" data-k="drenag">drenagem</span><span class="kw on" data-k="recapeamento">recapeamento</span><span class="kw on" data-k="infra.*vi[a√°]r">infra vi√°ria</span><span class="kw on" data-k="tapa.?buraco">tapa-buraco</span><span class="kw on" data-k="meio.?fio">meio-fio</span><span class="kw on" data-k="sinaliza[√ßc][√£a]o.*vi[a√°]r">sinal. vi√°ria</span><span class="kw on" data-k="base.*granular">base granular</span></div><div class="actions"><button class="btn btn-p" id="btnB" onclick="buscar()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>Buscar</button><button class="btn btn-s" onclick="limpar()">Limpar</button></div></div></div>
<div class="stats" id="sBar" style="display:none"><div class="stat"><div class="stat-label">Encontradas</div><div class="stat-val sv-blue" id="sT">0</div></div><div class="stat"><div class="stat-label">Valor total</div><div class="stat-val sv-green" id="sV">R$ 0</div></div><div class="stat"><div class="stat-label">Abertas</div><div class="stat-val sv-amber" id="sA">0</div></div><div class="stat"><div class="stat-label">Novas</div><div class="stat-val sv-cyan" id="sN">0</div></div></div>
<div class="error" id="errS"><span>‚ö†</span><div id="errT"></div></div>
<div class="loading" id="ldS"><div class="loader"></div><div class="load-txt">Consultando PNCP...</div><div class="load-det" id="ldD"></div></div>
<div id="resC"></div>
</main>
<footer>LicitaMonitor v2.0 ¬∑ <a href="https://pncp.gov.br" target="_blank">API PNCP</a></footer>
<script>
let deferredPrompt;window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;document.getElementById('installB').classList.add('show')});document.getElementById('installBtn').addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;document.getElementById('installB').classList.remove('show')});if('serviceWorker'in navigator)navigator.serviceWorker.register('./sw.js');
const API='https://pncp.gov.br/api/consulta/v1/contratacoes/publicacao',UFS=['AC','AL','AM','AP','BA','CE','DF','ES','GO','MA','MG','MS','MT','PA','PB','PE','PI','PR','RJ','RN','RO','RR','RS','SC','SE','SP','TO'],PRE={df:['DF'],dg:['DF','GO'],dv:['DF','GO','MG','BA','SP'],all:[],x:[]},SK='lm_seen_v2';
const hj=new Date(),t30=new Date(hj);t30.setDate(hj.getDate()-30);document.getElementById('dF').value=fd(hj);document.getElementById('dI').value=fd(t30);
const ufG=document.getElementById('ufG');UFS.forEach(u=>{const e=document.createElement('span');e.className='uf-chip'+(u==='DF'?' on df-hl':'');e.textContent=u;e.dataset.u=u;e.onclick=()=>{e.classList.toggle('on');if(u==='DF')e.classList.toggle('df-hl',e.classList.contains('on'));uqb()};ufG.appendChild(e)});document.querySelectorAll('.kw').forEach(t=>t.onclick=()=>t.classList.toggle('on'));
function tog(id){const b=document.getElementById('body-'+id),t=document.getElementById('tog-'+id);b.classList.toggle('collapsed');t.textContent=b.classList.contains('collapsed')?'‚ñ∂':'‚ñº'}
function gUF(){return[...document.querySelectorAll('.uf-chip.on')].map(e=>e.dataset.u)}function ufP(p){const u=PRE[p]||[];document.querySelectorAll('.uf-chip').forEach(e=>{const a=u.length?u.includes(e.dataset.u):false;e.classList.toggle('on',a);if(e.dataset.u==='DF')e.classList.toggle('df-hl',a)});uqb()}function uqb(){const s=gUF().sort().join(',');document.querySelectorAll('.uf-pre').forEach(b=>b.classList.remove('on'));const m={'DF':0,'DF,GO':1,'BA,DF,GO,MG,SP':2,'':3};const i=m[s];if(i!==undefined)[...document.querySelectorAll('.uf-pre')][i]?.classList.add('on')}uqb();
function fd(d){return d.toISOString().split('T')[0]}function fa(s){return s.replace(/-/g,'')}function fc(v){if(!v&&v!==0)return'‚Äî';if(v>=1e9)return'R$ '+(v/1e9).toFixed(1)+'B';if(v>=1e6)return'R$ '+(v/1e6).toFixed(1)+'M';if(v>=1e3)return'R$ '+(v/1e3).toFixed(0)+'k';return'R$ '+v.toLocaleString('pt-BR')}function fcF(v){if(!v&&v!==0)return'‚Äî';return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',minimumFractionDigits:0,maximumFractionDigits:0}).format(v)}function fdt(s){if(!s)return'‚Äî';try{return new Date(s).toLocaleDateString('pt-BR')}catch{return s}}function gKW(){return[...document.querySelectorAll('.kw.on')].map(t=>t.dataset.k)}function mKW(t,k){if(!t)return false;const l=t.toLowerCase();return k.some(w=>{try{return new RegExp(w,'i').test(l)}catch{return l.includes(w)}})}function hKW(t,k){if(!t)return'';let r=t;k.forEach(w=>{try{r=r.replace(new RegExp('('+w+')','gi'),'<mark>$1</mark>')}catch{}});return r}function mCl(n){if(!n)return'mod-o';const l=n.toLowerCase();if(l.includes('concorr'))return'mod-c';if(l.includes('preg'))return'mod-p';if(l.includes('dispensa'))return'mod-d';return'mod-o'}function eUF(i){if(i.unidadeOrgao?.ufSigla)return i.unidadeOrgao.ufSigla;if(i.orgaoEntidade?.ufSigla)return i.orgaoEntidade.ufSigla;if(i.ufSigla)return i.ufSigla;const r=(i.orgaoEntidade?.razaoSocial||'').toUpperCase();if(r.includes('DISTRITO FEDERAL')||r.includes('NOVACAP')||r.includes('/DF'))return'DF';if(r.includes('GOI√ÅS')||r.includes('GOIAS')||r.includes('/GO'))return'GO';return i.uf||'??'}function ubCl(u){return u==='DF'?'ub-df':u==='GO'?'ub-go':'ub-x'}function getSeen(){try{return JSON.parse(localStorage.getItem(SK)||'[]')}catch{return[]}}function saveSeen(ids){try{localStorage.setItem(SK,JSON.stringify(ids.slice(-500)))}catch{}}
let allR=[],filtR=[],actUF=null;
window.addEventListener('load',()=>setTimeout(buscar,400));
async function buscar(){const di=document.getElementById('dI').value,df=document.getElementById('dF').value,mod=document.getElementById('mod').value,ufs=gUF(),kws=gKW();if(!di||!df){shErr('Preencha as datas.');return}if(!kws.length){shErr('Ative pelo menos 1 palavra-chave.');return}hErr();allR=[];filtR=[];actUF=null;document.getElementById('resC').innerHTML='';document.getElementById('sBar').style.display='none';shLd(true);stTxt('Buscando...');document.getElementById('btnB').disabled=true;try{let all=[];const ub=ufs.length?ufs:[''];for(const u of ub){let pg=1,tp=1;while(pg<=tp&&pg<=15){document.getElementById('ldD').textContent=(u||'BR')+' ¬∑ p√°g '+pg+(tp>1?'/'+tp:'');const p=new URLSearchParams({dataInicial:fa(di),dataFinal:fa(df),pagina:pg,tamanhoPagina:'50'});if(u)p.set('uf',u);if(mod)p.set('codigoModalidadeContratacao',mod);const res=await fetch(API+'?'+p);if(!res.ok){if(res.status===404)break;throw new Error('HTTP '+res.status)}const d=await res.json();if(!d.data||!d.data.length)break;d.data.forEach(i=>i._uf=u||eUF(i));all=all.concat(d.data);tp=d.totalPaginas||1;pg++;await new Promise(r=>setTimeout(r,250))}}const seen=new Set();allR=all.filter(i=>{const t=[i.objetoCompra,i.orgaoEntidade?.razaoSocial,i.descricao].filter(Boolean).join(' ');return mKW(t,kws)}).filter(i=>{const id=i.numeroControlePNCP||JSON.stringify(i);if(seen.has(id))return false;seen.add(id);return true});const prev=getSeen(),cur=allR.map(i=>i.numeroControlePNCP).filter(Boolean);allR.forEach(i=>{i._isNew=i.numeroControlePNCP&&!prev.includes(i.numeroControlePNCP)});saveSeen([...new Set([...prev,...cur])]);filtR=[...allR];shLd(false);render(filtR,kws);stats(filtR);const nc=allR.filter(i=>i._isNew).length;stTxt(filtR.length+' licit.'+(nc?' ¬∑ '+nc+' novas':''))}catch(e){shLd(false);shErr(e.message.includes('fetch')?'CORS ‚Äî use links diretos':'Erro: '+e.message);stTxt('Erro')}document.getElementById('btnB').disabled=false}
function render(res,kws){const c=document.getElementById('resC');if(!res.length){c.innerHTML='<div class="empty fi"><div class="empty-icon">üîç</div><div class="empty-t">Nenhuma licita√ß√£o</div><p>Amplie o per√≠odo ou altere filtros.</p></div>';return}const uc={};allR.forEach(i=>{const u=i._uf||'??';uc[u]=(uc[u]||0)+1});const su=Object.entries(uc).sort((a,b)=>a[0]==='DF'?-1:b[0]==='DF'?1:b[1]-a[1]);let h='<div class="res-head"><div class="res-count"><b>'+res.length+'</b> licita√ß√µes</div><select class="sort-sel" onchange="srt(this.value)"><option value="dd">Recentes</option><option value="da">Antigas</option><option value="vd">Maior R$</option><option value="va">Menor R$</option></select></div>';if(su.length>1){h+='<div class="ruf-bar"><span class="ruf-label">UF:</span><span class="ruf-chip'+(actUF?'':' on')+'" onclick="fUF(null)">Todas<span class="ruf-count"> '+allR.length+'</span></span>';su.forEach(([u,n])=>{h+='<span class="ruf-chip'+(actUF===u?' on':'')+'" onclick="fUF(\''+u+'\')">'+u+'<span class="ruf-count"> '+n+'</span></span>'});h+='</div>'}h+='<div class="res-list">';res.forEach((i,idx)=>{const org=i.orgaoEntidade?.razaoSocial||'‚Äî',obj=i.objetoCompra||'',mod=i.modalidadeNome||i.modalidadeLicitacaoNome||'',val=i.valorTotalEstimado||i.valorTotalHomologado||null,dAb=i.dataAberturaProposta||i.dataEncerramentoProposta||null,sit=i.situacaoCompraNome||'',uf=i._uf||'??',ano=i.anoCompra||'',seq=i.sequencialCompra||'',cnpj=i.orgaoEntidade?.cnpj||'';let lk='#';if(cnpj&&ano&&seq)lk='https://pncp.gov.br/app/editais/'+cnpj+'/'+ano+'/'+seq;const nw=i._isNew;h+='<div class="res-card fi'+(nw?' is-new':'')+'" style="animation-delay:'+Math.min(idx*.02,.3)+'s" onclick="window.open(\''+lk+'\',\'_blank\')">'+(nw?'<span class="new-tag">Nova</span>':'')+'<div class="res-top"><span class="uf-badge '+ubCl(uf)+'">'+uf+'</span><span class="res-org">'+org+'</span>'+(mod?'<span class="res-mod '+mCl(mod)+'">'+mod+'</span>':'')+'</div><div class="res-obj">'+hKW(obj,kws)+'</div><div class="res-meta">'+(val?'<span class="mi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg><span class="val">'+fcF(val)+'</span></span>':'')+(dAb?'<span class="mi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><b>'+fdt(dAb)+'</b></span>':'')+(sit?'<span class="mi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><b>'+sit+'</b></span>':'')+'</div><a class="res-link" href="'+lk+'" target="_blank" onclick="event.stopPropagation()">Ver no PNCP ‚Üí</a></div>'});h+='</div>';c.innerHTML=h}
function fUF(u){actUF=u;filtR=u?allR.filter(i=>i._uf===u):[...allR];render(filtR,gKW());stats(filtR)}function srt(m){switch(m){case'dd':filtR.sort((a,b)=>new Date(b.dataPublicacaoPncp||0)-new Date(a.dataPublicacaoPncp||0));break;case'da':filtR.sort((a,b)=>new Date(a.dataPublicacaoPncp||0)-new Date(b.dataPublicacaoPncp||0));break;case'vd':filtR.sort((a,b)=>(b.valorTotalEstimado||0)-(a.valorTotalEstimado||0));break;case'va':filtR.sort((a,b)=>(a.valorTotalEstimado||0)-(b.valorTotalEstimado||0));break}render(filtR,gKW())}function stats(r){document.getElementById('sBar').style.display='grid';document.getElementById('sT').textContent=r.length;document.getElementById('sV').textContent=fc(r.reduce((s,i)=>s+(i.valorTotalEstimado||0),0));document.getElementById('sA').textContent=r.filter(i=>(i.situacaoCompraNome||'').toLowerCase().match(/divulgada|aberta|publicada/)).length;document.getElementById('sN').textContent=r.filter(i=>i._isNew).length}
function shLd(s){document.getElementById('ldS').classList.toggle('on',s)}function stTxt(t){document.getElementById('stTxt').textContent=t}function shErr(t){document.getElementById('errT').innerHTML='<b>'+t+'</b>';document.getElementById('errS').classList.add('on')}function hErr(){document.getElementById('errS').classList.remove('on')}function limpar(){allR=[];filtR=[];actUF=null;document.getElementById('resC').innerHTML='';document.getElementById('sBar').style.display='none';hErr();stTxt('Pronto')}
</script>
</body>
</html>
